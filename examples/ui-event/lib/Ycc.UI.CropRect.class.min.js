!function(a){a.UI.CropRect=function(b){a.UI.Base.call(this,b),this.ctrlSize=6,this.enableDragOut=!1,this.fill=!0,this.ctrlRect1=new a.Math.Rect,this.ctrlRect2=new a.Math.Rect,this.ctrlRect3=new a.Math.Rect,this.ctrlRect4=new a.Math.Rect,this.btns=[],this.btnHeight=38,this.btnVerticalPadding=10,this.extend(b),this._initUI()},a.UI.CropRect.prototype=new a.UI.Base,a.UI.CropRect.prototype.constructor=a.UI.CropRect,a.UI.CropRect.prototype.showBtns=function(b){if(this.btns.length>0){for(var c=0;c<this.btns.length;c++)a.utils.isObj(this.btns[c])&&(this.btns[c].show=b);this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}},a.UI.CropRect.prototype.setCtrlBtns=function(b){var c=this;0!==b.length&&b.forEach(function(b){b=a.utils.extend({content:"",rectBgColor:"#666",color:"#fff",onclick:function(){}},b);var d=new a.UI.SingleLineText(b);d.addListener("mouseover",function(){this.color="#ccc",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),d.addListener("mouseout",function(){this.color="#fff",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),c.btns.push(d),c.belongTo.addUI(d)})},a.UI.CropRect.prototype.computeUIProps=function(){this.belongTo._setCtxProps(this);var b=this.rect,c=0,d=0,e=this.rect.x,f=this.rect.y+this.rect.height,g=this.belongTo.yccInstance.getStageWidth(),h=this.belongTo.yccInstance.getStageHeight();if(this.ctrlRect1=new a.Math.Rect(b.x,b.y,this.ctrlSize,this.ctrlSize),this.ctrlRect2=new a.Math.Rect(b.x+b.width-this.ctrlSize,b.y,this.ctrlSize,this.ctrlSize),this.ctrlRect3=new a.Math.Rect(b.x,b.y+b.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),this.ctrlRect4=new a.Math.Rect(b.x+b.width-this.ctrlSize,b.y+b.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),0!==this.btns.length){for(var i=0;i<this.btns.length;i++){var j=this.btns[i];j.overflow="auto",j.xAlign="center",j.rect.width=parseInt(this.ctx.measureText(j.content).width+2*this.btnVerticalPadding),j.rect.height=this.btnHeight,c+=j.rect.width+1}e+c>g&&(e=g-c),f+this.btnHeight>h&&(f=this.rect.y<this.btnHeight?0:this.rect.y-this.btnHeight-2);for(var k=0;k<this.btns.length;k++){var l=this.btns[k];l.rect.x=e+d,l.rect.y=f+2,d+=l.rect.width+1}}},a.UI.CropRect.prototype._initUI=function(){var b=this;this.userData=this.userData?this.userData:{},this.addListener("dragstart",function(b){this.userData.ctrlStart=0,this.userData.dragStartPosition=new a.Math.Rect(this.rect),this.userData.dragStartMousePosition=new a.Math.Dot(b);for(var c=new a.Math.Dot(b),d=1;d<=4;d++)if(c.isInRect(this["ctrlRect"+d]))return this.userData.ctrlStart=d,null}),this.addListener("dragging",function(a){var b,c,d,e,f=this.userData.dragStartPosition,g=this.userData.dragStartMousePosition;if(this.userData.ctrlStart<=4&&this.userData.ctrlStart>=1?(1===this.userData.ctrlStart&&(b=a.x-(g.x-f.x),c=a.y-(g.y-f.y),d=f.width-(a.x-f.x),e=f.height-(a.y-f.y),b<=f.x+f.width-2*this.ctrlSize&&(this.rect.x=b),c<=f.y+f.height-2*this.ctrlSize&&(this.rect.y=c)),2===this.userData.ctrlStart&&(b=f.x,c=a.y-(g.y-f.y),d=a.x-f.x+(f.width+f.x-g.x),e=f.height-(a.y-f.y),this.rect.x=b,c<=f.y+f.height-2*this.ctrlSize&&(this.rect.y=c)),3===this.userData.ctrlStart&&(b=a.x-(g.x-f.x),c=f.y,d=f.width-(a.x-f.x),e=a.y-f.y+(f.height+f.y-g.y),b<=f.x+f.width-2*this.ctrlSize&&(this.rect.x=b),this.rect.y=c),4===this.userData.ctrlStart&&(this.rect.x=f.x,this.rect.y=f.y,this.rect.width=a.x-f.x+(f.x+f.width-g.x),this.rect.height=a.y-f.y+(f.y+f.height-g.y)),d>=2*this.ctrlSize&&(this.rect.width=d),e>=2*this.ctrlSize&&(this.rect.height=e)):(this.rect.x=a.x-a.mouseDownYccEvent.targetDeltaPosition.x,this.rect.y=a.y-a.mouseDownYccEvent.targetDeltaPosition.y),this.rect.width<=2*this.ctrlSize&&(this.rect.width=2*this.ctrlSize),this.rect.height<=2*this.ctrlSize&&(this.rect.height=2*this.ctrlSize),!this.enableDragOut){var h=this.belongTo.yccInstance.getStageWidth(),i=this.belongTo.yccInstance.getStageHeight();this.rect.x<=0&&(this.rect.x=0),this.rect.y<=0&&(this.rect.y=0),this.rect.x+this.rect.width>=h&&(this.rect.x=h-this.rect.width),this.rect.y+this.rect.height>=i&&(this.rect.y=i-this.rect.height)}this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),this.addListener("dragend",function(a){b.showBtns(!0)})},a.UI.CropRect.prototype.render=function(){this.renderRectBgColor();var a=this.rect;this.ctx.save(),this.ctx.fillStyle=this.fillStyle,this.ctx.strokeStyle=this.strokeStyle,this.ctx.beginPath(),this.ctx.rect(a.x,a.y,a.width,a.height),this.ctx.closePath(),this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.beginPath(),this.ctx.rect(this.ctrlRect1.x,this.ctrlRect1.y,this.ctrlRect1.width,this.ctrlRect1.height),this.ctx.rect(this.ctrlRect2.x,this.ctrlRect2.y,this.ctrlRect2.width,this.ctrlRect2.height),this.ctx.rect(this.ctrlRect3.x,this.ctrlRect3.y,this.ctrlRect3.width,this.ctrlRect3.height),this.ctx.rect(this.ctrlRect4.x,this.ctrlRect4.y,this.ctrlRect4.width,this.ctrlRect4.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()}}(window.Ycc);
//# sourceMappingURL=Ycc.UI.CropRect.class.min.js.map