!function(a){a.Ycc=function b(){this.canvasDom=null,this.ctx=null,this.layerList=[],this.photoManager=null,this.layerManager=null,this.ticker=null,this.loader=new b.Loader,this.baseUI=null},a.Ycc.prototype.getStageWidth=function(){return this.ctx.canvas.width},a.Ycc.prototype.getStageHeight=function(){return this.ctx.canvas.height},a.Ycc.prototype.bindCanvas=function(a){this.canvasDom=a,this.ctx=this.canvasDom.getContext("2d"),this.layerList=[],this.photoManager=new Ycc.PhotoManager(this),this.layerManager=new Ycc.LayerManager(this),this.ticker=new Ycc.Ticker(this),this.baseUI=new Ycc.UI(this.ctx.canvas),this.init()},a.Ycc.prototype.init=function(){this._initStageEvent()},a.Ycc.prototype._initStageEvent=function(){for(var a=this,b=["mousemove","mousedown","mouseup","click","mouseenter","mouseout"],c=0;c<b.length;c++)this.ctx.canvas.addEventListener(b[c],function(b){for(var c=new Ycc.Event({type:b.type,x:parseInt(b.clientX-a.ctx.canvas.getBoundingClientRect().left),y:parseInt(b.clientY-a.ctx.canvas.getBoundingClientRect().top)}),d=a.layerList.length-1;d>=0;d--){var e=a.layerList[d];e.enableEventManager&&e.triggerListener(b.type,c)}});this.ctx.canvas.addEventListener("mousemove",function(b){for(var c,d=parseInt(b.clientX-a.ctx.canvas.getBoundingClientRect().left),e=parseInt(b.clientY-a.ctx.canvas.getBoundingClientRect().top),f=null,g=a.layerList.length-1;g>=0;g--){var h=a.layerList[g];if(f=h.getUIFromPointer(new Ycc.Math.Dot(d,e)),null!==f&&null!==f)break}null!==f?f===this.___overUI?(c=new Ycc.Event({type:"mouseover",x:d,y:e}),f.triggerListener("mouseover",c)):(c=new Ycc.Event({type:"mouseout",x:d,y:e}),this.___overUI&&this.___overUI.triggerListener("mouseout",c),this.___overUI=f):this.___overUI&&(c=new Ycc.Event({type:"mouseout",x:d,y:e}),this.___overUI.triggerListener("mouseout",c),this.___overUI=null)}),this.ctx.canvas.addEventListener("mouseout",function(b){var c=new Ycc.Event({type:"mouseup",x:parseInt(b.clientX-a.ctx.canvas.getBoundingClientRect().left),y:parseInt(b.clientY-a.ctx.canvas.getBoundingClientRect().top)});c.x>parseInt(this.width)&&(c.x=parseInt(this.width)),c.x<0&&(c.x=0),c.y>parseInt(this.height)&&(c.y=parseInt(this.height)),c.y<0&&(c.y=0);for(var d=a.layerList.length-1;d>=0;d--){var e=a.layerList[d];e.enableEventManager&&e.triggerListener(c.type,c)}})},a.Ycc.prototype.clearStage=function(){this.ctx.clearRect(0,0,this.getStageWidth(),this.getStageHeight())},a.Ycc.prototype.reRenderStage=function(){this.clearStage(),this.layerManager.renderAllLayerToStage()}}(window),function(a){a.utils={},a.utils.extend=function(b,c,d){var e={};d&&(c=a.utils.deepClone(c));for(var f in b)b.hasOwnProperty(f)&&(e[f]=b[f],c&&null!=c[f]&&(e[f]=c[f]));return e},a.utils.mergeObject=function(a,b){b=b||{};for(var c in a)"undefined"!=typeof b[c]&&(a[c]=b[c]);return a},a.utils.isString=function(a){return"string"==typeof a},a.utils.isNum=function(a){return"number"==typeof a},a.utils.isObj=function(a){return"object"==typeof a},a.utils.isFn=function(a){return"function"==typeof a},a.utils.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},a.utils.deepClone=function(b){function c(b){var e={};for(var f in b)b.hasOwnProperty(f)&&(e[f]=b[f],a.utils.isArray(b[f])?e[f]=d(b[f]):a.utils.isObj(b[f])?e[f]=c(b[f]):e[f]=b[f]);return e}function d(b){for(var e=[],f=null,g=0;g<b.length;g++)f=b[g],a.utils.isArray(f)?e.push(d(f)):a.utils.isObj(f)?e.push(c(f)):e.push(f);return e}return a.utils.isArray(b)?d(b):c(b)}}(Ycc),function(a){a.utils.extend;a.Math=function(){},a.Math.Dot=function(a){this.x=0,this.y=0;var b=arguments.length;1===b?(this.x=a.x,this.y=a.y):2===b&&(this.x=arguments[0],this.y=arguments[1])},a.Math.Dot.prototype.isInRect=function(a){return this.x>=a.x&&this.x<=a.x+a.width&&this.y>=a.y&&this.y<=a.y+a.height},a.Math.Rect=function(a){this.x=0,this.y=0,this.width=0,this.height=0;var b=arguments.length;1===b?(this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height):3===b?(this.x=arguments[0].x,this.y=arguments[0].y,this.width=arguments[1],this.height=arguments[2]):4===b&&(this.x=arguments[0],this.y=arguments[1],this.width=arguments[2],this.height=arguments[3]),this.toPositive()},a.Math.Rect.prototype.toPositive=function(){var a=this.x,b=this.y,c=this.x+this.width,d=this.y+this.height;this.x=a<c?a:c,this.y=b<d?b:d,this.width=Math.abs(this.width),this.height=Math.abs(this.height)}}(window.Ycc),function(a){a.Ticker=function(a){this.yccInstance=a,this.startTime=Date.now(),this.lastFrameTime=0,this.frameListenerList=[],this.defaultFrameRate=60,this.realTimeFrameRate=this.defaultFrameRate,this.frameAllCount=0,this.timerTickCount=0,this._timerId=0,this._isRunning=!1},a.Ticker.prototype.start=function(a){function b(){var f=0===c.timerTickCount?c.startTime:Date.now();c.timerTickCount++;var g=f-c.startTime,h=c.frameAllCount*d;g>h&&(c.frameAllCount++,c.realTimeFrameRate=1e3*c.frameAllCount/(f-c.startTime),c.broadcastFrameEvent(),c.broadcastToLayer(),(Date.now()-c.lastFrameTime)/d>3&&(console.warn("第%d帧：",c.frameAllCount),console.warn("该帧率已低于正常值的1/3！若相邻帧持续警告，请适当降低帧率，或者提升刷新效率！","正常值：",a," 当前值：",1e3/(Date.now()-c.lastFrameTime))),c.lastFrameTime=Date.now()),c._timerId=e.call(window,b)}var c=this;if(!c._isRunning){a=a?a:c.defaultFrameRate;var d=1e3/a,e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;c.frameAllCount=0,e||(e=function(a){return window.setTimeout(a,1e3/60)}),c.startTime=Date.now(),c._timerId=e.call(window,b),c._isRunning=!0}},a.Ticker.prototype.stop=function(){var a=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame;a||(a=function(a){return window.clearTimeout(a)}),a(this._timerId),this._isRunning=!1},a.Ticker.prototype.addFrameListener=function(a){this.frameListenerList.push(a)},a.Ticker.prototype.broadcastFrameEvent=function(){for(var b=0;b<this.frameListenerList.length;b++){var c=this.frameListenerList[b];a.utils.isFn(c)&&c()}},a.Ticker.prototype.broadcastToLayer=function(){for(var a=0;a<this.yccInstance.layerList.length;a++){var b=this.yccInstance.layerList[a];b.show&&b.enableFrameEvent&&b.onFrameComing()}}}(window.Ycc),function(a){a.Loader=function(){this.imageRes={}},a.Loader.prototype._loadImage=function(b,c){var d=new Image;d.src=b,d.onload=function(){a.utils.isFn(c)&&c(d)}},a.Loader.prototype.loadImageList=function(b,c,d){for(var e=this,f=0,g=Object.keys(b),h=0;h<g.length;h++){var i=b[g[h]];this._loadImage(i,function(b){return function(h){e.imageRes[b]=h,f++,a.utils.isFn(d)&&d(h),f===g.length&&a.utils.isFn(c)&&c(e.imageRes)}}(g[h]))}}}(window.Ycc),function(a){a.Event=function(b){this.type=b?b:"",this.x=0,this.y=0,this.originEvent=null,this.mouseDownYccEvent=null,this.mouseUpYccEvent=null,this.stop=!1,this.target=null,this.targetDeltaPosition=null,a.utils.isObj(b)&&a.utils.mergeObject(this,b)}}(window.Ycc),function(a){a.Listener=function(){this.listeners={},this.stopType={},this.stopAllEvent=!1,this.onclick=null,this.onmousedown=null,this.onmouseup=null,this.onmousemove=null,this.ondragstart=null,this.ondragging=null,this.ondragend=null,this.onmouseover=null,this.onmouseout=null},a.Listener.prototype.addListener=function(a,b){var c=this.listeners[a];c||(this.listeners[a]=[]),this.listeners[a].indexOf(b)===-1&&this.listeners[a].push(b)},a.Listener.prototype.stop=function(a){this.stopType[a]=!0},a.Listener.prototype.triggerListener=function(b,c){if(!this.stopAllEvent){this.stopType[b]||a.utils.isFn(this["on"+b])&&this["on"+b].call(this,c);var d=this.listeners[b];if(d&&a.utils.isArray(d))for(var e=0;e<d.length;e++)this.stopType[b]||d[e].call(this,c)}},a.Listener.prototype.removeListener=function(b,c){var d=this.listeners[b];if(d&&a.utils.isArray(d))for(var e=0;e<d.length;e++)if(d[e]===c)return void d.splice(e,1)}}(window.Ycc),function(a){var b=0;a.Layer=function(c,d){a.Listener.call(this),d=d||{},this.uiList=[],this.yccInstance=c,this.canvasDom=null,this.ctx=null,this.id=b++,this.type="ui",this.textValue="",this.name=d.name?d.name:"图层_"+this.type+"_"+this.id,this.x=0,this.y=0,this.width=c.getStageWidth(),this.height=c.getStageHeight(),this.show=!0,this.enableEventManager=!1,this.enableFrameEvent=!1,this.onFrameComing=function(){},a.utils.mergeObject(this,d),this.init()},a.Layer.prototype=new a.Listener,a.Layer.prototype.constructor=a.Layer,a.Layer.prototype.init=function(){var a=this,b=document.createElement("canvas");b.width=this.width,b.height=this.height,this.ctx=b.getContext("2d"),this.canvasDom=b,a._setCtxProps(),a._initEvent()},a.Layer.prototype._initEvent=function(){function b(b){if(!b.stop&&!(e&&b.x===e.x&&b.y===e.y||f&&b.x===f.x&&b.y===f.y)){if(g=!0,e){if(!h){var c=new a.Event({type:"dragstart",x:e.x,y:e.y,mouseDownYccEvent:e});d.triggerListener(c.type,c),e.target&&(c.target=e.target,c.target.triggerListener(c.type,c))}h=!0;var i=new a.Event({type:"dragging",x:b.x,y:b.y,mouseDownYccEvent:e});return d.triggerListener(i.type,i),e.target&&(i.target=e.target,i.target.triggerListener(i.type,i)),null}for(var j=d.uiList.length-1;j>=0;j--){var k=d.uiList[j],l=new a.Math.Dot(b.x-k.belongTo.x,b.y-k.belongTo.y);if(l.isInRect(k.rect)){b.stop=!0,b.mouseDownYccEvent=e,b.mouseUpYccEvent=f,b.target=k,k.triggerListener(b.type,b);break}}}}function c(b){if(!b.stop)for(var c=d.uiList.length-1;c>=0;c--){var g=d.uiList[c],h=b.x-g.belongTo.x,i=b.y-g.belongTo.y,j=new a.Math.Dot(h,i);if(g.rect&&j.isInRect(g.rect)&&b.stop===!1){b.stop=!0,b.mouseDownYccEvent=e,b.mouseUpYccEvent=f,b.target=g,b.targetDeltaPosition=new a.Math.Dot(b.x-g.rect.x,b.y-g.rect.y),g.triggerListener(b.type,b);break}}}var d=this,e=null,f=null,g=!1,h=!1;this.addListener("click",function(a){g||c(a)}),this.addListener("mousedown",function(a){g=!1,h=!1,e=a,c(a)}),this.addListener("mouseup",function(b){if(h){var g=new a.Event({type:"dragend",x:b.x,y:b.y,mouseDownYccEvent:e});d.triggerListener("dragend",g),e&&e.target&&(d.target=e.target,d.target.triggerListener("dragend",g))}b.mouseDownYccEvent=e=null,f=b,c(b)}),this.addListener("mousemove",b)},a.Layer.prototype._setCtxProps=function(b){var c=this,d={fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontSize:"16px",fontFamily:"微软雅黑",font:"16px 微软雅黑",textBaseline:"hanging",fillStyle:"red",strokeStyle:"blue"};d=a.utils.extend(d,b),d.font=[d.fontStyle,d.fontVariant,d.fontWeight,d.fontSize,d.fontFamily].join(" ");for(var e in d)d.hasOwnProperty(e)&&(c.ctx[e]=d[e])},a.Layer.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},a.Layer.prototype.renderToStage=function(){this.show&&this.yccInstance.ctx.drawImage(this.ctx.canvas,0,0,this.width,this.height)},a.Layer.prototype.addUI=function(a){a.init(this),this.uiList.push(a)},a.Layer.prototype.removeUI=function(a){var b=this.uiList.indexOf(a);b!==-1&&this.uiList.splice(b,1)},a.Layer.prototype.render=function(){for(var a=0;a<this.uiList.length;a++)this.uiList[a].show&&this.uiList[a].render()},a.Layer.prototype.reRender=function(){this.clear();for(var a=0;a<this.uiList.length;a++)this.uiList[a].show&&(this.uiList[a].computeUIProps(),this.uiList[a].render())},a.Layer.prototype.getUIFromPointer=function(a){for(var b=this,c=b.uiList.length-1;c>=0;c--){var d=b.uiList[c];if(a.isInRect(d.rect))return d}return null}}(window.Ycc),function(a){a.LayerManager=function(a){this.yccInstance=a},a.LayerManager.prototype.init=function(){},a.LayerManager.prototype.newLayer=function(b){var c=new a.Layer(this.yccInstance,b);return this.yccInstance.layerList.push(c),c},a.LayerManager.prototype.deleteLayer=function(a){for(var b=this.yccInstance.layerList,c=0;c<b.length;c++)if(b[c].id===a.id)return this.yccInstance.layerList.splice(c,1),a;return a},a.LayerManager.prototype.renderAllLayerToStage=function(){for(var a=0;a<this.yccInstance.layerList.length;a++){var b=this.yccInstance.layerList[a];b.show&&this.yccInstance.ctx.drawImage(b.canvasDom,b.x,b.y,b.width,b.height)}},a.LayerManager.prototype.reRenderAllLayerToStage=function(){this.yccInstance.clearStage();for(var a=0;a<this.yccInstance.layerList.length;a++){var b=this.yccInstance.layerList[a];b.reRender(),b.show&&this.yccInstance.ctx.drawImage(b.canvasDom,b.x,b.y,b.width,b.height)}},a.LayerManager.prototype.mergeLayers=function(b){var c=b.length;if(0===c)return null;for(var d=new a.Layer(this.yccInstance,{name:"合并图层"}),e=0;e<c;e++){var f=b[e];d.ctx.drawImage(f.canvasDom,0,0,f.width,f.height),f=null}return this.yccInstance.layerList=[],this.yccInstance.layerList.push(d),d},a.LayerManager.prototype.enableEventManagerOnly=function(a){if(!a)return!1;for(var b=0;b<this.yccInstance.layerList.length;b++)this.yccInstance.layerList[b].enableEventManager=!1;return a.enableEventManager=!0,this},a.LayerManager.prototype.enableEventManagerAll=function(a){for(var b=0;b<this.yccInstance.layerList.length;b++)this.yccInstance.layerList[b].enableEventManager=a;return this}}(window.Ycc),function(a){var b=function(a){this.imageData=a,this.createTime=new Date,this.id=this.createTime.getTime()};a.PhotoManager=function(a){this.yccInstance=a,this.ctx=a.ctx,this._photos=[]},a.PhotoManager.prototype.takePhoto=function(){return this._photos.push(new b(this.ctx.getImageData(0,0,this.yccInstance.getStageWidth(),this.yccInstance.getStageHeight()))),this},a.PhotoManager.prototype.getHistoryPhotos=function(){return this._photos},a.PhotoManager.prototype.showPhoto=function(a){return this.ctx.putImageData(a.imageData,0,0),a},a.PhotoManager.prototype.showLastPhoto=function(){var a=this._photos.length,b=!1;return a>=1&&(b=this._photos[a-1],this.showPhoto(b)),b},a.PhotoManager.prototype.delPhotoById=function(a){for(var b=this._photos.slice(0),c=0;c<b.length;c++)if(b[c].id===a)return b.splice(c+1,1),this._photos=b,b[c];return!1}}(window.Ycc),function(a){if(!a||!a.utils)return console.error("Error: Ycc.ui needs module `Ycc` and `Ycc.utils`!");a.utils.isObj,a.utils.isArray,a.utils.isString,a.utils.isNum,a.utils.extend;a.UI=function(a){this._photos=[],this.ctx=a.getContext("2d"),this.ctxWidth=a.width,this.ctxHeight=a.height},a.UI.prototype.text=function(a,b,c){return this.ctx.save(),c?this.ctx.fillText(b,a[0],a[1]):this.ctx.strokeText(b,a[0],a[1]),this.ctx.restore(),this},a.UI.prototype.line=function(a,b){return this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(a[0],a[1]),this.ctx.lineTo(b[0],b[1]),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},a.UI.prototype.rect=function(a,b,c){return this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(a[0],a[1],b[0]-a[0],b[1]-a[1]),this.ctx.closePath(),c?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.ellipse=function(a,b,c,d,e){this.ctx.save();var f=b>c?b:c,g=b/f,h=c/f;return this.ctx.translate(a[0],a[1]),this.ctx.rotate(parseInt(d)*Math.PI/180),this.ctx.translate(-a[0],-a[1]),this.ctx.scale(g,h),this.ctx.beginPath(),this.ctx.arc(a[0]/g,a[1]/h,f,0,2*Math.PI,!1),this.ctx.closePath(),e?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.circleArc=function(a,b,c,d,e){return this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(a[0],a[1],b,c/180*Math.PI,d/180*Math.PI,e),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},a.UI.prototype.sector=function(a,b,c,d,e,f){return this.ctx.save(),this.ctx.beginPath(),this.ctx.lineTo(a[0],a[1]),this.ctx.arc(a[0],a[1],b,c*Math.PI/180,d*Math.PI/180,f),this.ctx.lineTo(a[0],a[1]),this.ctx.closePath(),e?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.foldLine=function(a){if(a.length<2)return console.error("Error: 参数错误！");this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(a[0][0],a[0][1]);for(var b=0;b<a.length;b++)this.ctx.lineTo(a[b][0],a[b][1]);return this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.circle=function(a,b,c){return this.ellipse(a,b,b,0,c),this},a.UI.prototype.image=function(a,b){var c=this;return b=b||[0,0],c.ctx.save(),c.ctx.beginPath(),c.ctx.drawImage(a,b[0],b[1]),c.ctx.closePath(),c.ctx.restore(),this},a.UI.prototype._getMaxLenContent=function(a,b){var c=a,d=0;if(this.ctx.measureText(a).width<=b)return a;for(var e=0;e<a.length;e++)if(c=a.slice(0,e),d=this.ctx.measureText(c).width,d>b)return a.slice(0,e-1)},a.UI.prototype.scale=function(a,b){return this.ctx.scale(a,b),this},a.UI.prototype.clear=function(){var a={fillStyle:"#fff"};return this.ctx.fillStyle=a.fillStyle,this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,0,this.ctxWidth,this.ctxHeight),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore(),this}}(window.Ycc),function(a){var b=0;a.UI.Base=function(c){a.Listener.call(this),this.uid=b++,this.ctx=null,this.rect=new a.Math.Rect,this.rectBgColor="transparent",this.rectBgAlpha=1,this.show=!0,this.lineWidth=1,this.fillStyle="black",this.strokeStyle="black",this.belongTo=null,this.userData=null,this.baseUI=null,this.beforeInit=null,this.afterInit=null,this.extend(c)},a.UI.Base.prototype=new a.Listener,a.UI.Base.prototype.constructor=a.UI.Base,a.UI.Base.prototype.init=function(b){a.utils.isFn(this.beforeInit)&&this.beforeInit(),this.belongTo=b,this.ctx=b.ctx,this.baseUI=new a.UI(b.canvasDom),this.computeUIProps(),a.utils.isFn(this.afterInit)&&this.afterInit()},a.UI.Base.prototype.computeUIProps=function(){},a.UI.Base.prototype.renderRectBgColor=function(){this.ctx.save(),this.ctx.globalAlpha=this.rectBgAlpha,this.ctx.fillStyle=this.rectBgColor,this.ctx.beginPath(),this.ctx.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()},a.UI.Base.prototype.render=function(a){},a.UI.Base.prototype.getMaxContentInWidth=function(a,b){var c=a,d=0;if(this.ctx.measureText(a).width<=b)return a;for(var e=0;e<a.length;e++)if(c=a.slice(0,e+1),d=this.ctx.measureText(c).width,d>b)return a.slice(0,e)},a.UI.Base.prototype.extend=function(a){a=a||{};for(var b in this)"undefined"!=typeof a[b]&&(this[b]=a[b]);return this}}(window.Ycc),function(a){a.UI.Ellipse=function(b){a.UI.Base.call(this,b),this.point=new a.Math.Dot,this.width=20,this.height=10,this.angle=0,this.color="black",this.fill=!1,this.extend(b)},a.UI.Ellipse.prototype=new a.UI.Base,a.UI.Ellipse.prototype.constructor=a.UI.Ellipse,a.UI.Ellipse.prototype.computeUIProps=function(){var a=this.point.x,b=this.point.y,c=this.width/2,d=this.height/2,e=this.angle/180*Math.PI,f=Math.sqrt(Math.cos(e)*Math.cos(e)*d*d+Math.sin(e)*Math.sin(e)*c*c)+b,g=-f+2*b,h=Math.sqrt(Math.cos(e)*Math.cos(e)*c*c+Math.sin(e)*Math.sin(e)*d*d)+a,i=-h+2*a;this.rect.x=i,this.rect.y=g,this.rect.width=h-i,this.rect.height=f-g},a.UI.Ellipse.prototype.render=function(){this.renderRectBgColor();var a=this.width,b=this.angle,c=this.height;this.ctx.save();var d=a>c?a:c,e=a/d,f=c/d;this.ctx.translate(this.point.x,this.point.y),this.ctx.rotate(parseInt(b)*Math.PI/180),this.ctx.translate(-this.point.x,-this.point.y),this.ctx.scale(e,f),this.ctx.beginPath(),this.ctx.arc(this.point.x/e,this.point.y/f,d/2,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fillStyle=this.ctx.strokeStyle=this.color,this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.restore()}}(window.Ycc),function(a){a.UI.Image=function(b){a.UI.Base.call(this,b),this.fillMode="none",this.res=null,this.scale9GridRect=null,this.extend(b)},a.UI.Image.prototype=new a.UI.Base,a.UI.Image.prototype.constructor=a.UI.Image,a.UI.Image.prototype.computeUIProps=function(){"auto"===this.fillMode&&(this.rect.width=this.res.width,this.rect.height=this.res.height)},a.UI.Image.prototype.render=function(){this.renderRectBgColor();var b=this.rect,c=this.res;if(this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(b.x,b.y,b.width,b.height),this.ctx.closePath(),this.ctx.fillStyle=this.rectBgColor,this.ctx.fill(),this.ctx.restore(),"none"===this.fillMode)this.ctx.drawImage(this.res,0,0,b.width,b.height,b.x,b.y,b.width,b.height);else if("scale"===this.fillMode)this.ctx.drawImage(this.res,0,0,c.width,c.height,b.x,b.y,b.width,b.height);else if("auto"===this.fillMode)this.ctx.drawImage(this.res,0,0,c.width,c.height,b.x,b.y,b.width,b.height);else if("repeat"===this.fillMode)for(var d=parseInt(b.width/c.width)+1,e=parseInt(b.height/c.height)+1,f=0;f<d;f++)for(var g=0;g<e;g++){var h=c.width,i=c.height;f===d-1&&(h=b.width-f*c.width),g===e-1&&(i=b.height-g*c.height),this.ctx.drawImage(this.res,0,0,h,i,b.x+c.width*f,b.y+c.height*g,h,i)}else if("scale9Grid"===this.fillMode){var j,k,l=this.scale9GridRect,m=[];m[0]={},m[0].src=new a.Math.Rect(0,0,l.x,l.y),m[0].dest=new a.Math.Rect(b.x,b.y,l.x,l.y),m[2]={},m[2].src=new a.Math.Rect(l.x+l.width,0,c.width-l.x-l.width,l.y),m[2].dest=new a.Math.Rect(b.width-m[2].src.width+b.x,b.y,m[2].src.width,m[2].src.height),m[6]={},m[6].src=new a.Math.Rect(0,l.y+l.height,l.x,c.height-l.y-l.height),m[6].dest=new a.Math.Rect(b.x,b.y+b.height-m[6].src.height,m[6].src.width,m[6].src.height),m[8]={},m[8].src=new a.Math.Rect(l.x+l.width,l.y+l.height,c.width-l.x-l.width,c.height-l.y-l.height),m[8].dest=new a.Math.Rect(b.width-m[8].src.width+b.x,b.y+b.height-m[8].src.height,m[8].src.width,m[8].src.height),m[1]={},m[1].src=new a.Math.Rect(l.x,0,l.width,l.y),m[1].dest=new a.Math.Rect(m[0].dest.x+m[0].dest.width,b.y,b.width-m[0].dest.width-m[2].dest.width,l.y),m[3]={},m[3].src=new a.Math.Rect(m[0].src.x,l.y,m[0].src.width,l.height),m[3].dest=new a.Math.Rect(m[0].dest.x,m[0].dest.y+m[0].dest.height,m[0].dest.width,b.height-m[0].dest.height-m[6].dest.height),m[5]={},m[5].src=new a.Math.Rect(m[2].src.x,l.y,m[2].src.width,l.height),m[5].dest=new a.Math.Rect(m[2].dest.x,m[3].dest.y,m[2].dest.width,m[3].dest.height),m[7]={},m[7].src=new a.Math.Rect(m[1].src.x,m[6].src.y,l.width,m[6].src.height),m[7].dest=new a.Math.Rect(m[1].dest.x,m[6].dest.y,m[1].dest.width,m[6].dest.height),m[4]={},m[4].src=new a.Math.Rect(l.x,l.y,l.width,l.height),m[4].dest=new a.Math.Rect(m[1].dest.x,m[5].dest.y,m[1].dest.width,m[5].dest.height);for(var n=0;n<m.length;n++)m[n]&&(j=m[n].src,k=m[n].dest,this.ctx.drawImage(this.res,j.x,j.y,j.width,j.height,k.x,k.y,k.width,k.height))}}}(window.Ycc),function(a){a.UI.Line=function(b){a.UI.Base.call(this,b),this.start=new a.Math.Dot(0,0),this.end=new a.Math.Dot(0,0),this.width=1,this.color="black",this.extend(b)},a.UI.Line.prototype=new a.UI.Base,a.UI.Line.prototype.constructor=a.UI.Line,a.UI.Line.prototype.computeUIProps=function(){this.rect.x=this.start.x<this.end.x?this.start.x:this.end.x,this.rect.y=this.start.y<this.end.y?this.start.y:this.end.y,this.rect.width=Math.abs(this.start.x-this.end.x),this.rect.height=Math.abs(this.start.y-this.end.y)},a.UI.Line.prototype.render=function(){this.renderRectBgColor(),this.ctx.save(),this.ctx.strokeStyle=this.color,this.ctx.strokeWidth=this.width,this.ctx.beginPath(),this.ctx.moveTo(this.start.x,this.start.y),this.ctx.lineTo(this.end.x,this.end.y),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}}(window.Ycc),function(a){a.UI.MultiLineText=function(b){a.UI.Base.call(this,b),this.displayLines=[],this.content="",this.fontSize="16px",this.lineHeight=24,this.fill=!0,this.color="black",this.wordBreak="break-all",this.overflow="auto",this.extend(b)},a.UI.MultiLineText.prototype=new a.UI.Base,a.UI.MultiLineText.prototype.constructor=a.UI.MultiLineText,a.UI.MultiLineText.prototype.computeUIProps=function(){function a(){function a(){function a(d){var e=[],f=b.ctx.measureText(d).width;if(f<=c.rect.width)return e.push(d),e;for(var g=0;g<d.length;g++){var h=d.slice(0,g+1),i=b.ctx.measureText(h).width;if(i>c.rect.width){var j=d.slice(0,g-1);e.push(j);var k=d.slice(g-1);return e=e.concat(a(k))}}}for(var e=[],f=0;f<d.length;f++){var g=d[f],h=a(g);e=e.concat(h)}return e}function e(){function a(d){var e=[],f=b.ctx.measureText(d).width;if(f<=c.rect.width)return e.push(d),e;for(var g=0,h=0;h<d.length;h++){var i=d.slice(0,h+1),j=b.ctx.measureText(i).width,k=d[h];if(" "===k&&(g=h),j>c.rect.width){var l="",m="";return" "===k||0===g?(l=d.slice(0,h),e.push(l),m=d.slice(h),e=e.concat(a(m))):(l=d.slice(0,g),e.push(l),m=d.slice(g),e=e.concat(a(m)))}}}for(var e=[],f=0;f<d.length;f++){var g=d[f],h=a(g);e=e.concat(h)}return e}switch(c.wordBreak){case"no-break":case"break-all":return a();case"break-word":return e();default:return a()}}var b=this,c=this,d=this.content.split(/(?:\r\n|\r|\n)/);this.displayLines=a(),"auto"===c.overflow&&(c.rect.height=c.lineHeight*renderLines.length)},a.UI.MultiLineText.prototype.render=function(a){this.renderRectBgColor();var b=this;if(b.ctx=a||b.ctx,!b.ctx)return void console.error("[Ycc error]:","ctx is null !");var c=this;this.ctx.save(),this.ctx.fillStyle=c.color,this.ctx.strokeStyle=c.color;for(var d=0;d<b.displayLines.length;d++){var e=c.rect.x,f=c.rect.y+d*c.lineHeight;if(f+c.lineHeight>c.rect.y+c.rect.height)break;this.baseUI.text([e,f],b.displayLines[d],c.fill)}this.ctx.restore()}}(window.Ycc),function(a){a.UI.Rect=function(b){a.UI.Base.call(this,b),this.fill=!0,this.color="black",this.extend(b)},a.UI.Rect.prototype=new a.UI.Base,a.UI.Rect.prototype.constructor=a.UI.Rect,a.UI.Rect.prototype.render=function(){this.renderRectBgColor();var a=this.rect;this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.rect(a.x,a.y,a.width,a.height),this.ctx.closePath(),this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.restore()}}(window.Ycc),function(a){a.UI.CropRect=function(b){a.UI.Base.call(this,b),this.ctrlSize=6,this.enableDragOut=!1,this.fill=!0,this.ctrlRect1=new a.Math.Rect,this.ctrlRect2=new a.Math.Rect,this.ctrlRect3=new a.Math.Rect,this.ctrlRect4=new a.Math.Rect,this.btns=[],this.btnHeight=38,this.btnVerticalPadding=10,this.extend(b),this._initUI()},a.UI.CropRect.prototype=new a.UI.Base,a.UI.CropRect.prototype.constructor=a.UI.CropRect,a.UI.CropRect.prototype.showBtns=function(b){if(this.btns.length>0){for(var c=0;c<this.btns.length;c++)a.utils.isObj(this.btns[c])&&(this.btns[c].show=b);this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}},a.UI.CropRect.prototype.setCtrlBtns=function(b){var c=this;0!==b.length&&b.forEach(function(b){b=a.utils.extend({content:"",rectBgColor:"#666",color:"#fff",onclick:function(){}},b);var d=new a.UI.SingleLineText(b);d.addListener("mouseover",function(){this.color="#ccc",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),d.addListener("mouseout",function(){this.color="#fff",this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),c.btns.push(d),c.belongTo.addUI(d)})},a.UI.CropRect.prototype.computeUIProps=function(){this.belongTo._setCtxProps(this);var b=this.rect,c=0,d=0,e=this.rect.x,f=this.rect.y+this.rect.height,g=this.belongTo.yccInstance.getStageWidth(),h=this.belongTo.yccInstance.getStageHeight();if(this.ctrlRect1=new a.Math.Rect(b.x,b.y,this.ctrlSize,this.ctrlSize),this.ctrlRect2=new a.Math.Rect(b.x+b.width-this.ctrlSize,b.y,this.ctrlSize,this.ctrlSize),this.ctrlRect3=new a.Math.Rect(b.x,b.y+b.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),this.ctrlRect4=new a.Math.Rect(b.x+b.width-this.ctrlSize,b.y+b.height-this.ctrlSize,this.ctrlSize,this.ctrlSize),0!==this.btns.length){for(var i=0;i<this.btns.length;i++){var j=this.btns[i];j.overflow="auto",j.xAlign="center",j.rect.width=parseInt(this.ctx.measureText(j.content).width+2*this.btnVerticalPadding),j.rect.height=this.btnHeight,c+=j.rect.width+1}e+c>g&&(e=g-c),f+this.btnHeight>h&&(f=this.rect.y<this.btnHeight?0:this.rect.y-this.btnHeight-2);for(var k=0;k<this.btns.length;k++){var l=this.btns[k];l.rect.x=e+d,l.rect.y=f+2,d+=l.rect.width+1}}},a.UI.CropRect.prototype._initUI=function(){var b=this;this.userData=this.userData?this.userData:{},this.addListener("dragstart",function(b){this.userData.ctrlStart=0,this.userData.dragStartPosition=new a.Math.Rect(this.rect),this.userData.dragStartMousePosition=new a.Math.Dot(b);for(var c=new a.Math.Dot(b),d=1;d<=4;d++)if(c.isInRect(this["ctrlRect"+d]))return this.userData.ctrlStart=d,null}),this.addListener("dragging",function(a){var b,c,d,e,f=this.userData.dragStartPosition,g=this.userData.dragStartMousePosition;if(this.userData.ctrlStart<=4&&this.userData.ctrlStart>=1?(1===this.userData.ctrlStart&&(b=a.x-(g.x-f.x),c=a.y-(g.y-f.y),d=f.width-(a.x-f.x),e=f.height-(a.y-f.y),b<=f.x+f.width-2*this.ctrlSize&&(this.rect.x=b),c<=f.y+f.height-2*this.ctrlSize&&(this.rect.y=c)),2===this.userData.ctrlStart&&(b=f.x,c=a.y-(g.y-f.y),d=a.x-f.x+(f.width+f.x-g.x),e=f.height-(a.y-f.y),this.rect.x=b,c<=f.y+f.height-2*this.ctrlSize&&(this.rect.y=c)),3===this.userData.ctrlStart&&(b=a.x-(g.x-f.x),c=f.y,d=f.width-(a.x-f.x),e=a.y-f.y+(f.height+f.y-g.y),b<=f.x+f.width-2*this.ctrlSize&&(this.rect.x=b),this.rect.y=c),4===this.userData.ctrlStart&&(this.rect.x=f.x,this.rect.y=f.y,this.rect.width=a.x-f.x+(f.x+f.width-g.x),this.rect.height=a.y-f.y+(f.y+f.height-g.y)),d>=2*this.ctrlSize&&(this.rect.width=d),e>=2*this.ctrlSize&&(this.rect.height=e)):(this.rect.x=a.x-a.mouseDownYccEvent.targetDeltaPosition.x,this.rect.y=a.y-a.mouseDownYccEvent.targetDeltaPosition.y),this.rect.width<=2*this.ctrlSize&&(this.rect.width=2*this.ctrlSize),this.rect.height<=2*this.ctrlSize&&(this.rect.height=2*this.ctrlSize),!this.enableDragOut){var h=this.belongTo.yccInstance.getStageWidth(),i=this.belongTo.yccInstance.getStageHeight();this.rect.x<=0&&(this.rect.x=0),this.rect.y<=0&&(this.rect.y=0),this.rect.x+this.rect.width>=h&&(this.rect.x=h-this.rect.width),this.rect.y+this.rect.height>=i&&(this.rect.y=i-this.rect.height)}this.belongTo.yccInstance.layerManager.reRenderAllLayerToStage()}),this.addListener("dragend",function(a){b.showBtns(!0)})},a.UI.CropRect.prototype.render=function(){this.renderRectBgColor();var a=this.rect;this.ctx.save(),this.ctx.fillStyle=this.fillStyle,this.ctx.strokeStyle=this.strokeStyle,this.ctx.beginPath(),this.ctx.rect(a.x,a.y,a.width,a.height),this.ctx.closePath(),this.fill?this.ctx.fill():this.ctx.stroke(),this.ctx.beginPath(),this.ctx.rect(this.ctrlRect1.x,this.ctrlRect1.y,this.ctrlRect1.width,this.ctrlRect1.height),this.ctx.rect(this.ctrlRect2.x,this.ctrlRect2.y,this.ctrlRect2.width,this.ctrlRect2.height),this.ctx.rect(this.ctrlRect3.x,this.ctrlRect3.y,this.ctrlRect3.width,this.ctrlRect3.height),this.ctx.rect(this.ctrlRect4.x,this.ctrlRect4.y,this.ctrlRect4.width,this.ctrlRect4.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()}}(window.Ycc),function(a){a.UI.SingleLineText=function(b){a.UI.Base.call(this,b),this.displayContent="",this.content="",this.fontSize="16px",this.fill=!0,this.color="black",this.xAlign="left",this.yAlign="center",this.overflow="auto",this.extend(b)},a.UI.SingleLineText.prototype=new a.UI.Base,a.UI.SingleLineText.prototype.constructor=a.UI.SingleLineText,a.UI.SingleLineText.prototype.computeUIProps=function(){var a=this;a.belongTo._setCtxProps(a);var b=this.ctx.measureText(this.content).width;this.displayContent=this.content,b>this.rect.width&&("hidden"===this.overflow?a.displayContent=a.getMaxContentInWidth(this.content,this.rect.width):"auto"===this.overflow&&(this.rect.width=b)),"hidden"===this.overflow?b>this.rect.width&&(a.displayContent=a.getMaxContentInWidth(this.content,this.rect.width)):"auto"===this.overflow&&(b>this.rect.width&&(this.rect.width=b),parseInt(this.fontSize)>this.rect.height&&(this.rect.height=parseInt(this.fontSize)))},a.UI.SingleLineText.prototype.render=function(a){var b=this;if(b.belongTo._setCtxProps(b),this.renderRectBgColor(),b.ctx=a||b.ctx,!b.ctx)return void console.error("[Ycc error]:","ctx is null !");var c,d,e=parseInt(b.fontSize),f=this;if(c=f.rect.x,"center"===this.xAlign){var g=this.ctx.measureText(this.displayContent).width;c+=(this.rect.width-g)/2}return d=f.rect.y,e>f.rect.height?console.warn("[Ycc warning] : ","行高不够，或者文字太大！",f):("center"===f.yAlign&&(d=d+f.rect.height/2-e/2),this.ctx.save(),this.ctx.fillStyle=f.color,this.ctx.strokeStyle=f.color,this.ctx.fillText(b.displayContent,c,d),void this.ctx.restore())}}(window.Ycc);
//# sourceMappingURL=ycc.min.js.map