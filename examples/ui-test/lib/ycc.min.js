!function(a){a.Ycc=function b(a,c){this.canvasDom=a,this.stage=a,this.ctx=this.canvasDom.getContext("2d"),this.ctxWidth=this.canvasDom.width,this.ctxHeight=this.canvasDom.height,this.layerList=[],this.config=new b.Config(this,c),this.photoManager=b.PhotoManager?new b.PhotoManager(this):null,this.layerManager=b.LayerManager?new b.LayerManager(this):null,this.stageEventManager=new b.EventManager(this.stage),this.init()},a.Ycc.prototype.init=function(){var a=this;this.ctx.fillStyle=this.config.canvasBgColor,this.ctx.fillRect(0,0,this.ctxWidth,this.ctxHeight);for(var b in this.config.ctxProps)this.ctx[b]=this.config.ctxProps[b];for(var b in this.stageEventManager)0===b.indexOf("on")&&(console.log(b),this.stageEventManager[b]=function(b){for(var c=a.layerList.length-1;c>=0;c--){var d=a.layerList[c];d.eventManager.mouseDownEvent=a.stageEventManager.mouseDownEvent,d.eventManager["on"+b.type](b)}})},a.Ycc.prototype.clearStage=function(){this.ctx.clearRect(0,0,this.ctxWidth,this.ctxHeight)}}(window),function(a){a.utils={},a.utils.inherits=function(a,b){function c(){d.isFn(b)&&b.call(this,""),a.call(this,"")}var d=this;return c.prototype=a.prototype,c},a.utils.extend=function(a,b,c){var d={};c&&(b=deepClone(b));for(var e in a)d[e]=a[e],b&&null!=b[e]&&(d[e]=b[e]);return d},a.utils.isString=function(a){return"string"==typeof a},a.utils.isNum=function(a){return"number"==typeof a},a.utils.isObj=function(a){return"object"==typeof a},a.utils.isFn=function(a){return"function"==typeof a},a.utils.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},a.utils.isDot=function(a){return this.isArray(a)&&2==a.length},a.utils.isDotList=function(a){if(a&&this.isArray(a)){for(var b=0;b<a.length;b++)if(!this.isDot(a[b]))return!1;return!0}return!1},a.utils.dotAddDot=function(a,b){if(!this.isArray(a)||!this.isArray(b))return console.log("%c Function addOffset params wrong","color:red"),a;if(a.length!==b.length)return console.log("%c Function addOffset params arr.length must equal offset.length","color:red"),a;for(var c=a.slice(0),d=0;d<b.length;d++)c[d]+=b[d];return c},a.utils.dotsMatchAxis=function(a,b,c){for(var d=a.slice(0),e=0;e<a.length;e++)d[e][0]*=b,d[e][1]*=c;return d},a.utils.deepClone=function(b){function c(b){var e={};for(var f in b)e[f]=b[f],a.utils.isArray(b[f])?e[f]=d(b[f]):a.utils.isObj(b[f])?e[f]=c(b[f]):e[f]=b[f];return e}function d(b){for(var e=[],f=null,g=0;g<b.length;g++)f=b[g],a.utils.isArray(f)?e.push(d(f)):a.utils.isObj(f)?e.push(c(f)):e.push(f);return e}return a.utils.isArray(b)?d(b):c(b)}}(Ycc),function(a){a.Config=function(a,b){if(b=b?b:{},this.yccInstance=a,this.ctxProps=new Object({lineWidth:3,strokeStyle:"red",fillStyle:"red",font:"32px arial"}),this.canvasBgColor=b.canvasBgColor||"transparent",this.width=b.width||800,this.height=b.height||600,b&&b.ctxProps)for(var c in this.ctxProps)b.ctxProps[c]&&(this.ctxProps[c]=b.ctxProps[c])}}(window.Ycc),function(a){if(!a||!a.utils)return console.error("Error: Ycc.ui needs module `Ycc` and `Ycc.utils`!");a.utils.isObj,a.utils.isArray,a.utils.isString,a.utils.isNum,a.utils.extend;a.UI=function(a){this._photos=[],this.ctx=a.getContext("2d"),this.ctxWidth=a.width,this.ctxHeight=a.height},a.UI.prototype.text=function(a,b,c){return this.ctx.save(),c?this.ctx.fillText(b,a[0],a[1]):this.ctx.strokeText(b,a[0],a[1]),this.ctx.restore(),this},a.UI.prototype.line=function(a,b){return this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(a[0],a[1]),this.ctx.lineTo(b[0],b[1]),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},a.UI.prototype.rect=function(a,b,c){return this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(a[0],a[1],b[0]-a[0],b[1]-a[1]),this.ctx.closePath(),c?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.ellipse=function(a,b,c,d,e){this.ctx.save();var f=b>c?b:c,g=b/f,h=c/f;return this.ctx.translate(a[0],a[1]),this.ctx.rotate(parseInt(d)*Math.PI/180),this.ctx.translate(-a[0],-a[1]),this.ctx.scale(g,h),this.ctx.beginPath(),this.ctx.arc(a[0]/g,a[1]/h,f,0,2*Math.PI,!1),this.ctx.closePath(),e?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.circleArc=function(a,b,c,d,e){return this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(a[0],a[1],b,c/180*Math.PI,d/180*Math.PI,e),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},a.UI.prototype.sector=function(a,b,c,d,e,f){return this.ctx.save(),this.ctx.beginPath(),this.ctx.lineTo(a[0],a[1]),this.ctx.arc(a[0],a[1],b,c*Math.PI/180,d*Math.PI/180,f),this.ctx.lineTo(a[0],a[1]),this.ctx.closePath(),e?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.foldLine=function(a){if(a.length<2)return console.error("Error: 参数错误！");this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(a[0][0],a[0][1]);for(var b=0;b<a.length;b++)this.ctx.lineTo(a[b][0],a[b][1]);return this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.circle=function(a,b,c){return this.ellipse(a,b,b,0,c),this},a.UI.prototype.image=function(a,b){var c=this;return b=b||[0,0],c.ctx.save(),c.ctx.beginPath(),c.ctx.drawImage(a,b[0],b[1]),c.ctx.closePath(),c.ctx.restore(),this},a.UI.prototype.scale=function(a,b){return this.ctx.scale(a,b),this},a.UI.prototype.clear=function(){var a={fillStyle:"#fff"};return this.ctx.fillStyle=a.fillStyle,this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,0,this.ctxWidth,this.ctxHeight),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore(),this}}(window.Ycc),function(a){a.Loader=function(){},a.Loader.prototype.loadImage=function(b,c){var d=new Image;d.src=b,d.onload=function(){a.utils.isFn(c)&&c(d)}},a.Loader.prototype.loadImageList=function(b,c,d){for(var e=0,f={},g=Object.keys(b),h=0;h<g.length;h++){var i=b[g[h]];this.loadImage(i,function(b){return function(h){f[b]=h,e++,a.utils.isFn(d)&&d(h),e===g.length&&a.utils.isFn(c)&&c(f)}}(g[h]))}}}(window.Ycc),function(a){function b(b,d){var e={name:"",width:b.ctxWidth,height:b.ctxHeight,bgColor:"transparent",show:!0};d=a.utils.extend(e,d);var f=document.createElement("canvas");f.width=d.width,f.height=d.height,this.yccInstance=b,this.canvasDom=f,this.ctx=this.canvasDom.getContext("2d"),this.id=c++,this.name=d.name?d.name:"图层"+this.id,this.width=d.width,this.height=d.height,this.bgColor=d.bgColor,this.show=d.show,this.ui=a.UI?new a.UI(this.canvasDom):null,this.eventManager=a.EventManager?new a.EventManager(this.canvasDom):null}var c=0;b.prototype.init=function(){},b.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},b.prototype.renderToStage=function(){this.show&&this.yccInstance.ctx.drawImage(this.canvasDom,0,0,this.width,this.height)},a.LayerManager=function(a){this.yccInstance=a},a.LayerManager.prototype.init=function(){},a.LayerManager.prototype.newLayer=function(a){var c=new b(this.yccInstance,a);return this.yccInstance.layerList.push(c),c},a.LayerManager.prototype.deleteLayer=function(a){for(var b=this.yccInstance.layerList,c=0;c<b.length;c++)if(b[c].id===a.id)return this.yccInstance.layerList.splice(c,1),a;return a},a.LayerManager.prototype.renderAllLayerToStage=function(){for(var a=0;a<this.yccInstance.layerList.length;a++){var b=this.yccInstance.layerList[a];b.show&&this.yccInstance.ctx.drawImage(b.canvasDom,0,0,b.width,b.height)}}}(window.Ycc),function(a){function b(b,d){return function(e){var f=new c;return f.type=b,f.originEvent=e,f.x=e.clientX-d.canvasDom.getBoundingClientRect().left,f.y=e.clientY-d.canvasDom.getBoundingClientRect().top,"mousedown"===b?(d.mouseDown=!0,d.mouseMoving=!1,d.mouseDownEvent=f,a.utils.isFn(d["on"+b])&&d["on"+b](f),null):"mousemove"===b?(d.mouseMoving=!0,d["on"+b](f),!d.mouseDown||f.x===d.mouseDownEvent.x&&f.y===d.mouseDownEvent.y||(f.type="dragging",f.originEvent=e,a.utils.isFn(d["on"+f.type])&&d["on"+f.type](f)),a.utils.isFn(d["on"+b])&&d["on"+b](f),null):"mouseup"===b?(d.mouseDown=!1,d.mouseMoving=!1,a.utils.isFn(d["on"+b])&&d["on"+b](f),null):"click"===b?(d.mouseDown=!1,d.mouseMoving=!1,a.utils.isFn(d["on"+b])&&d["on"+b](f),null):void 0}}var c=function(a){this.type=a?a:"",this.x=0,this.y=0,this.originEvent=null};a.EventManager=function(a){this.canvasDom=a,this.mouseDown=!1,this.mouseDownEvent=null,this.mouseMoving=!1,this.init()},a.EventManager.prototype.init=function(){for(var a=this,c=this.canvasDom,d=["mousemove","mousedown","mouseup","click"],e=0;e<d.length;e++){var f=d[e];c.addEventListener(f,b(f,a))}},a.EventManager.prototype.onmousemove=function(a){},a.EventManager.prototype.onmousedown=function(a){},a.EventManager.prototype.onmouseup=function(a){},a.EventManager.prototype.onclick=function(a){},a.EventManager.prototype.ondragging=function(a){},a.EventManager.prototype.ondragend=function(a){}}(window.Ycc),function(a){var b=function(a){this.imageData=a,this.createTime=new Date,this.id=this.createTime.getTime()};a.PhotoManager=function(a){this.yccInstance=a,this.ctx=a.ctx,this._photos=[]},a.PhotoManager.prototype.takePhoto=function(){return this._photos.push(new b(this.ctx.getImageData(0,0,this.yccInstance.ctxWidth,this.yccInstance.ctxHeight))),this},a.PhotoManager.prototype.getHistoryPhotos=function(){return this._photos},a.PhotoManager.prototype.showPhoto=function(a){return this.ctx.putImageData(a.imageData,0,0),a},a.PhotoManager.prototype.showLastPhoto=function(){var a=this._photos.length,b=!1;return a>=1&&(b=this._photos[a-1],this.showPhoto(b)),b},a.PhotoManager.prototype.delPhotoById=function(a){for(var b=this._photos.slice(0),c=0;c<b.length;c++)if(b[c].id===a)return b.splice(c+1,1),this._photos=b,b[c];return!1}}(window.Ycc);
//# sourceMappingURL=ycc.min.js.map