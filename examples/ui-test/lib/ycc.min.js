!function(a){a.Ycc=function b(a,c){this.canvasDom=a,this.stage=a,this.ctx=this.canvasDom.getContext("2d"),this.ctxWidth=this.canvasDom.width,this.ctxHeight=this.canvasDom.height,this.layerList=[],this.config=c?c:{},this.photoManager=b.PhotoManager?new b.PhotoManager(this):null,this.layerManager=b.LayerManager?new b.LayerManager(this):null,this.stageEventManager=new b.EventManager(this),this.ticker=b.Ticker?new b.Ticker(this):null,this.baseUI=new b.UI(this.stage),this.init()},a.Ycc.prototype.getStageWidth=function(){return this.stage.width},a.Ycc.prototype.getStageHeight=function(){return this.stage.height},a.Ycc.prototype.init=function(){var a=this;for(var b in this.stageEventManager)0===b.indexOf("on")&&(console.log(b),this.stageEventManager[b]=function(b){for(var c=a.layerList.length-1;c>=0;c--){var d=a.layerList[c];d.enableEventManager&&d.triggerListener(b.type,b)}})},a.Ycc.prototype.clearStage=function(){this.ctx.clearRect(0,0,this.getStageWidth(),this.getStageHeight())}}(window),function(a){a.utils={},a.utils.extend=function(b,c,d){var e={};d&&(c=a.utils.deepClone(c));for(var f in b)b.hasOwnProperty(f)&&(e[f]=b[f],c&&null!=c[f]&&(e[f]=c[f]));return e},a.utils.isString=function(a){return"string"==typeof a},a.utils.isNum=function(a){return"number"==typeof a},a.utils.isObj=function(a){return"object"==typeof a},a.utils.isFn=function(a){return"function"==typeof a},a.utils.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},a.utils.deepClone=function(b){function c(b){var e={};for(var f in b)b.hasOwnProperty(f)&&(e[f]=b[f],a.utils.isArray(b[f])?e[f]=d(b[f]):a.utils.isObj(b[f])?e[f]=c(b[f]):e[f]=b[f]);return e}function d(b){for(var e=[],f=null,g=0;g<b.length;g++)f=b[g],a.utils.isArray(f)?e.push(d(f)):a.utils.isObj(f)?e.push(c(f)):e.push(f);return e}return a.utils.isArray(b)?d(b):c(b)}}(Ycc),function(a){if(!a||!a.utils)return console.error("Error: Ycc.ui needs module `Ycc` and `Ycc.utils`!");a.utils.isObj,a.utils.isArray,a.utils.isString,a.utils.isNum,a.utils.extend;a.UI=function(a){this._photos=[],this.ctx=a.getContext("2d"),this.ctxWidth=a.width,this.ctxHeight=a.height},a.UI.prototype.text=function(a,b,c){return this.ctx.save(),c?this.ctx.fillText(b,a[0],a[1]):this.ctx.strokeText(b,a[0],a[1]),this.ctx.restore(),this},a.UI.prototype.line=function(a,b){return this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(a[0],a[1]),this.ctx.lineTo(b[0],b[1]),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},a.UI.prototype.rect=function(a,b,c){return this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(a[0],a[1],b[0]-a[0],b[1]-a[1]),this.ctx.closePath(),c?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.ellipse=function(a,b,c,d,e){this.ctx.save();var f=b>c?b:c,g=b/f,h=c/f;return this.ctx.translate(a[0],a[1]),this.ctx.rotate(parseInt(d)*Math.PI/180),this.ctx.translate(-a[0],-a[1]),this.ctx.scale(g,h),this.ctx.beginPath(),this.ctx.arc(a[0]/g,a[1]/h,f,0,2*Math.PI,!1),this.ctx.closePath(),e?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.circleArc=function(a,b,c,d,e){return this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(a[0],a[1],b,c/180*Math.PI,d/180*Math.PI,e),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore(),this},a.UI.prototype.sector=function(a,b,c,d,e,f){return this.ctx.save(),this.ctx.beginPath(),this.ctx.lineTo(a[0],a[1]),this.ctx.arc(a[0],a[1],b,c*Math.PI/180,d*Math.PI/180,f),this.ctx.lineTo(a[0],a[1]),this.ctx.closePath(),e?this.ctx.fill():this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.foldLine=function(a){if(a.length<2)return console.error("Error: 参数错误！");this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(a[0][0],a[0][1]);for(var b=0;b<a.length;b++)this.ctx.lineTo(a[b][0],a[b][1]);return this.ctx.stroke(),this.ctx.restore(),this},a.UI.prototype.circle=function(a,b,c){return this.ellipse(a,b,b,0,c),this},a.UI.prototype.image=function(a,b){var c=this;return b=b||[0,0],c.ctx.save(),c.ctx.beginPath(),c.ctx.drawImage(a,b[0],b[1]),c.ctx.closePath(),c.ctx.restore(),this},a.UI.prototype._getMaxLenContent=function(a,b){var c=a,d=0;if(this.ctx.measureText(a).width<=b)return a;for(var e=0;e<a.length;e++)if(c=a.slice(0,e),d=this.ctx.measureText(c).width,d>b)return a.slice(0,e-1)},a.UI.prototype.scale=function(a,b){return this.ctx.scale(a,b),this},a.UI.prototype.clear=function(){var a={fillStyle:"#fff"};return this.ctx.fillStyle=a.fillStyle,this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,0,this.ctxWidth,this.ctxHeight),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore(),this}}(window.Ycc),function(a){a.Loader=function(){},a.Loader.prototype.loadImage=function(b,c){var d=new Image;d.src=b,d.onload=function(){a.utils.isFn(c)&&c(d)}},a.Loader.prototype.loadImageList=function(b,c,d){for(var e=0,f={},g=Object.keys(b),h=0;h<g.length;h++){var i=b[g[h]];this.loadImage(i,function(b){return function(h){f[b]=h,e++,a.utils.isFn(d)&&d(h),e===g.length&&a.utils.isFn(c)&&c(f)}}(g[h]))}}}(window.Ycc),function(a){a.LayerManager=function(a){this.yccInstance=a},a.LayerManager.prototype.init=function(){},a.LayerManager.prototype.newLayer=function(b){var c=new a.Layer(this.yccInstance,b);return this.yccInstance.layerList.push(c),c},a.LayerManager.prototype.deleteLayer=function(a){for(var b=this.yccInstance.layerList,c=0;c<b.length;c++)if(b[c].id===a.id)return this.yccInstance.layerList.splice(c,1),a;return a},a.LayerManager.prototype.renderAllLayerToStage=function(){for(var a=0;a<this.yccInstance.layerList.length;a++){var b=this.yccInstance.layerList[a];b.show&&this.yccInstance.ctx.drawImage(b.canvasDom,b.x,b.y,b.width,b.height)}},a.LayerManager.prototype.mergeLayers=function(b){var c=b.length;if(0===c)return null;for(var d=new a.Layer(this.yccInstance,{name:"合并图层"}),e=0;e<c;e++){var f=b[e];d.ctx.drawImage(f.canvasDom,0,0,f.width,f.height),f=null}return this.yccInstance.layerList=[],this.yccInstance.layerList.push(d),d},a.LayerManager.prototype.enableEventManagerOnly=function(a){if(!a)return!1;for(var b=0;b<this.yccInstance.layerList.length;b++)this.yccInstance.layerList[b].enableEventManager=!1;a.enableEventManager=!0}}(window.Ycc),function(a){function b(a,b){return function(d){var e=new c;return e.type=a,e.originEvent=d,e.x=d.clientX-b.canvasDom.getBoundingClientRect().left,e.y=d.clientY-b.canvasDom.getBoundingClientRect().top,"mousedown"===a?(b.mouseDown=!0,b.mouseMoving=!1,b.mouseDownEvent=e,b.broadcastToLayer(a,e),null):"mousemove"===a?(b.mouseMoving=!0,!b.mouseDown||e.x===b.mouseDownEvent.x&&e.y===b.mouseDownEvent.y||(e.type="dragging",e.originEvent=d,b.broadcastToLayer(a,e)),b.broadcastToLayer(a,e),null):"mouseup"===a?(b.mouseDown=!1,b.mouseMoving=!1,b.broadcastToLayer(a,e),null):"click"===a?(b.mouseDown=!1,b.mouseMoving=!1,b.broadcastToLayer(a,e),null):(b.broadcastToLayer(a,e),null)}}var c=function(a){this.type=a?a:"",this.x=0,this.y=0,this.originEvent=null};a.EventManager=function(a){this.yccInstance=a,this.canvasDom=a.stage,this.mouseDown=!1,this.mouseDownEvent=null,this.mouseMoving=!1,this.proxyEventTypes=["mousemove","mousedown","mouseup","click","mouseenter","mouseout"],this.init()},a.EventManager.prototype.init=function(){for(var a=this,c=this.canvasDom,d=a.proxyEventTypes,e=0;e<d.length;e++){var f=d[e];c.addEventListener(f,b(f,a))}},a.EventManager.prototype.broadcastToLayer=function(a,b){for(var c=this.yccInstance,d=c.layerList.length-1;d>=0;d--){var e=c.layerList[d];e.enableEventManager&&e.triggerListener(a,b)}}}(window.Ycc),function(a){var b=function(a){this.imageData=a,this.createTime=new Date,this.id=this.createTime.getTime()};a.PhotoManager=function(a){this.yccInstance=a,this.ctx=a.ctx,this._photos=[]},a.PhotoManager.prototype.takePhoto=function(){return this._photos.push(new b(this.ctx.getImageData(0,0,this.yccInstance.getStageWidth(),this.yccInstance.getStageHeight()))),this},a.PhotoManager.prototype.getHistoryPhotos=function(){return this._photos},a.PhotoManager.prototype.showPhoto=function(a){return this.ctx.putImageData(a.imageData,0,0),a},a.PhotoManager.prototype.showLastPhoto=function(){var a=this._photos.length,b=!1;return a>=1&&(b=this._photos[a-1],this.showPhoto(b)),b},a.PhotoManager.prototype.delPhotoById=function(a){for(var b=this._photos.slice(0),c=0;c<b.length;c++)if(b[c].id===a)return b.splice(c+1,1),this._photos=b,b[c];return!1}}(window.Ycc);
//# sourceMappingURL=ycc.min.js.map